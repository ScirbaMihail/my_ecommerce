## Description
Tasks what are going to be resolved are related to a single product. After solving all tasks, you will have a final product. It's an e-commerce app with a variety of functionalities, like custom user authentication, cart implementation, order processing, email services. In this product you will have to interact with almost all most used elements of Django Framework.

> IMPORTANT: All endpoints should be created using Django Rest Framework

## **Part 1 - start new project**
1. Create new Django project with name "my_shop"

## **Part 2 - design products logic**
1. Create new app `apps/products`

2. Create following model 
    * Product ***{ conditions: table name in db = products }***:
        * `id` ( is autogenerated by django )
        * `name` ***{ conditions: max length = 100, is unique }***
        * `description` ***{ conditions: might be empty }***
        * `price` ***{ conditions: min value = 0 }***
        * `amount` ***{ conditions: min value = 0 }***
        * `in_stock` ***{ conditions: boolean field, nullable, might be blank }***

3. Model has to be managed from django admin

4. `in_stock` field is going to be detected automatically by current amount. It can't be introduced manually, even from admin

    **Hint** use signals. 

5. Create endpoints for crud operations  Override `create` method. Use forms to validate request body data ***{ conditions: entire logic should be written in service layer }***

    **Hint** For easier implementation use ModelViewSet.

    **IMPORTANT!** Each endpoint has to be started as `api/products/` ( example: `api/products/create`, `api/products/{pk}/update`) 

    **IMPORTANT!** Access endpoints and paste screenshots with both error and success cases

## **Part 3 - API Documentation**
1. Implement swagger for documenting your api (search the internet for swagger and its implementation)

## **Part 4 - design custom user authentication process**
> Description: Custom user authentication consists of next functionalities: user does not have anymore username, because in role of username will act email.

### Custom User Authentication (due to lack of the frontend will be handles only in django admin)
1. Create new app `apps/authentication`

2. Crete following model:
    * User ***{ conditions: table name in db = users}***
        * `id` ( is autogenerated by django )
        * `email` ***{ conditions: unique }***
        * `is_staff` ***{ conditions: default = False }***
        * `is_active` ***{ conditions: default = True }***
        * `date_joined` ***{ conditions: use django built-in attribute (auto_now_add) }
        * `balance` ***{ conditions: min value = 0, default = 0 }

3. Create custom manager to handle creating user using email without username

4. Create custom backend to handle authentication process using email instead of username

5. Add following endpoints:
    * `api/users/{pk}/deposit` deposit money on the account

### JWT Authentication
1. Implement jwt authentication for endpoints

## **Part 5 - design cart logic**
1. Create new app `apps/cart`

2. Create next models:
    * Cart ***{ conditions: table name in db = carts }***
        - `id` ( autogenerated by django ) 
        - `user` ***{ conditions: foreign key to user, unique }***
        - `products` ***{ conditions: foreign key to products }***
        - `cost` ***{ conditions: final cost for all added products, default = 0, auto updated after adding products}***

            **Hint 1** Use ManyToMany relation to handle products managing in cart

            **Hint 2** Because ManyToMany relation creates automatically "through" table, but you need to handle the quantity of each products is added, specify "through" table name the following model ( CartProduct )

    * CartProduct ( "through" table ) ***{ conditions: table name in db = carts_products }***:
        - `id` (autogenerated by id)
        - `cart` ***{ conditions: foreign key to cart }***
        - `product` ***{ conditions: foreign key to products }***
        - `quantity` ***{ conditions: min value = 1, default = 1 }***

3. Model Cart has to be managed from django admin

4. Create following endpoints:
    * crud endpoints 

        **HINT** Use ModelViewSet. 

    * `api/cart/{pk}/items` retrieve all products from a cart and final cost as a JsonResponse in following format: `{"products": products, "cost": cost}`

        **IMPORTANT!** `products` from response has next format:
        ``` python fold
        products = [
            {
                "product": product1,
                "quantity": quantity1
            },
            {
                "product": product2,
                "quantity": quantity2
            },
            ...
        ]
        ```

## **Part 6 - deign ordering and transactions logic**
1. create app `apps/payments`

2. Create following models:
    * Order ***{ conditions: table name in db = orders }***
        * `id` ( is autogenerated by django )
        * `user` ***{ conditions: foreign key to user }***
        * `products` ***{ conditions: foreign key to product }***
        * `cost` ***{ conditions: min value = 0 }***
        * `payment_status` ***{ conditions: acceptable values = ["pending", "paid", "canceled"], default = "pending"}***

            **IMPORTANT!** `cost` field is auto-calculated

            **Hint 1** Use ManyToMany relation to handle products managing in order
    
            **Hint 2** Because ManyToMany relation creates automatically "through" table, but you need to handle the quantity of each products is added, specify "through" table name of the following model ( OrderProduct )


    * OrderProduct ("through" table) ***{ conditions: table name in db = orders_products }***:
        * `id` ( is autogenerated by django )
        * `order` ***{ conditions: foreign key to order }***
        * `product` ***{ conditions: foreign key to product }***
        * `quantity` ***{ conditions: min value = 1, default = 1 }***


    * Transaction ***{ conditions: table name in db = transactions }***
        * `id` ( is autogenerated by django )
        * `order` ***{ conditions: foreign key to order }***
        * `amount` ***{ conditions: min_value = 0 }*** ( currency units )
        * `currency` ***{conditions: acceptable values = [MDL, EUR, USD], default = MDL }
        * `status` ***{ conditions: acceptable values = [success, fail]}
        
3. Create following endpoints
    * `api/payments/transactions/list` retrieve all transactions
    * `api/payments/orders/list` retrieve all orders
    * `api/payments/orders/create` create an order
    * `api/payments/orders/{pk}/pay` The process of paying an order:<br>
        1. Start transaction:<br>
            If user's balance is greater then order's cost, then withdraw the balance with order's cost. Create new transaction with `status = success`, otherwise with `status = fail`
        2. If transaction status is success then update order's status to "paid", otherwise to "canceled" <br>